# 프록시 패턴

어떤 객체를 사용하고자 할때, 객체를 직접적으로 호출하는 것이 아니라 **해당 객체의 대리자 객체(proxy)를 통해 대상 객체에 접근하는 방식을 구현**한 패턴이다.

프록시 패턴은 대상 객체로의 직접적으로 접근하는 것을 통제해야할 때에도 사용된다.

![image](https://user-images.githubusercontent.com/41771874/172151846-c4fff693-d88a-4515-9f31-74926f1638a6.png)

**프록시 패턴이 사용되는 예 (보호 프록시)**

우리가 시스템 명령어를 실행하는 객체를 갖고 있을 때, 우리가 내부에서 그 객체를 사용하는 것이라면 괜찮지만

그 객체를 클라이언트에게 제공하려고 한다면 클라이언트 프로그램이 우리가 원치 않는 파일을 삭제하거나 설정을 변경하는 등의 명령을 내릴 수 있기 때문에 심각한 문제를 초래할 수 있습니다.

프록시 패턴은 **클라이언트에게 접근에 대한 컨트롤을 제공**하여 위와 같은 문제를 해결합니다.

## 프록시 패턴의 장점

- 사이즈가 큰 객체가 로딩되기 전에도 프록시를 통해 참조를 할 수 있다.
- 실제 객체의 public, protected 메소드를 숨기고 인터페이스를 통해 노출시킬 수 있다.
- 실제 객체에 접근하기 전에 사전처리(권한 검사)를 할 수 있다.

## 프록시 패턴의 단점

- 객체를 생성할 때 한 단계를 거치게 되므로, 빈번한 객체 생성이 필요한 경우 성능이 저하될 수 있다.
- 프록시 내부에서 객체 생성을 위해 스레드가 생성, 동기화가 구현되어야 하는 경우 성능이 저하될 수 있다.
- 로직이 난해해져 가독성이 떨어질 수 있다.

## 프록시 패턴의 종류

- **가상프록시**

꼭 필요로 하는 시점까지 **객체의 생성을 연기**하고, 해당 객체가 생성된 것 처럼 동작하도록 만들고 싶을 때 사용하는 패턴이다. 프록시 클래스에서 작은 단위의 작업을 처리하고 리소스가 많이 요구되는 작업들이 필요할 경우만 주체 클래스를 사용하도록 구현한다.

- **원격프록시**

원격 객체에 대한 접근을 제어. 로컬 환경에 존재하며, 원격 객체에 대한 대변자 역할을 하는 객체, 서로 다른 주소 공간에 있는 객체에 대해 마치 같은 주소 공간에 있는 것 처럼 동작하게 하는 패턴이다.(예: Google Docs)

- **보호프록시**

**주체 클래스에 대한 접근을 제어하기 위한 경우**에 객체에 대한 접근 권한을 제어하거나 객체마다 접근 권한을 달리하고 싶을 경우 사용하는 패턴으로 프록시 클래스에서 클라이언트가 주체 클래스에 대한 접근을 허용할지 말지 결정하도록 할 수 있다.



## 프록시 패턴 구현

- 인터페이스 (주체 클래스, 프록시 클래스의 인터페이스)

```java
public interface Subject {
	String DoAction();
}
```

- 주체 클래스

```java
public class RealSubject implements Subject {
	@Override
	public String DoAction() {
		return "DoAction - RealSubject";
	}
}
```

- 프록시 클래스

```java
public class Proxy implements Subject {
	Subject subject1;

	@Override
	public String DoAction() {
		System.out.println("호출에 대한 흐름 제어가 주목적, 반환 결과를 그대로 전달");
		//이 곳에 실제 객체에 접근하는 권한을 확인하는 코드가 추가되기도 함
		subject1 = new RealSubject();
		return subject1.DoAction();
	}
}
```

## 프록시 패턴 사용

```java
public class Main {  	
	public static void main(String[] args) { 		
		//직접 호출하지 않고 프록시를 호출한다. 		
		Subject proxy = new Proxy(); 		
		System.out.println(proxy.DoAction()); 	
	}
}
```
